# `tls-certificates`

## Usage

This relation interface describes the expected behavior of any charm claiming to be able to provide 
or consume TLS certificates.

As all Juju relations, the `tls-certificates` interface consists of a provider and a requirer. 
One of these, in this case the `provider`, will be expected to create TLS certificates where the 
`requirer` will be able to consume and use them for TLS communications.

## Behavior

Both the requirer and the provider need to adhere to a certain set of criteria to be considered 
compatible with the interface.

### On relation joined

The requirer:
- Shall generate (or use an existing) private-key
- Shall provide a list of CSR's

The Provider:
- Shall provide its CA certificate
- Shall provide its CA chain
- Shall provide certificates CSR

### On relation changed

If the requirer's data bucket changes, the provider is expected to overwrite the existing 
certificates and/or remove the pre-existing certificates from the relation data.

## Relation Data

### Requirer

[\[JSON Schema\]](schemasequirer.json)

The requirer specifies a set of client or server common names for which it requires certificates.

#### Example

```json
{
  "certificate_signing_requests": [
    "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ2FUQ0NBVkVDQVFBd0pERUxNQWtHQTFVRUJoTUNWVk14RlRBVEJnTlZCQU1NRENvdVltRnVZVzVoTG1OdgpiVENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFNaDQxVkdjajJ1c2F1L3R6amd3CkVCcEoxM3lCWDYvQUZjL25Na1R4VTYxT2JycldkVjkwQlcwbS9ZVWdxN0VRNWR3UkJIOFB3L3ZFN3NaN0FoVk0KOENncllKTzQxYWxmRTlFcjU2aFNxSlVpeFV2VXNtWUppcUtwTVpjT3QzSW14cnNHRkh2MXBoN0NoL3R1bCtXNgpNY3RXZnYrNWIreGhEYWZMcC8rMUZSQWhYTHlqZkd0ZCsrUTJISzV6ZS9qQUN4YzF3a3pFNmpwTkxwNHJGL1h5CjFKVXdkZDVYVURkWjVmL1JrWWNKaEJ2OHpWbjd0WEYvZ0FOVDc2bHI4ZS82VWZHK0FQUURvL1UrMUdpeG4yL0sKdHVnYVBNRFlBZ2xLYm9JQVh3em9HbEpIR1crcEZZTGU2eGhHTE15RWhCRmJ0a1BKNGRDS0l5Tnh1T29rSHp3Ygp5aDhDQXdFQUFhQUFNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUNZa0g1aVNhT0dGSnREWHhCd0xRNldxc0JhCnU3VkxhMHJubksrbCtmUjNwV2Q5UThqOG5PTXI4d2szb2FNQ2JFQ3RaSitqYjZEN2Y0aS9IN1BOOElOVzl6S0IKVjltVTh0YnhhRTdub2x0UW9XQTgwU3hSN3BhWWF3Tit0NnNWUTN3aTJyZ3F2aGpGVEJKQStiYmZsQjZRM3FzYgpOSDAwYUo3eTdrU1d1MWxxNkhERnh4L0FlMEZLVUNqQVNrWnhsU0taUEJYcWF1UG9tU3hCMVhGN1pWN244eGtOCjNIcU1UdnhiUDR5bU1RQ1hxaktzN2hBQUVmK0I3UjNHYzdmbnhQRDNMMGREU3dGanJXL2tvZy8wSTRNa1RiaGUKT29FRGdpT09UQmlHaDcvZ3RXTXVXcHBmYys0ckloR1FEMGRLR1NpUVFjL2tPMlExZmNyME1YM0Z0dnUwCi0tLS0tRU5EIENFUlRJRklDQVRFIFJFUVVFU1QtLS0tLQo=",
    "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ2FEQ0NBVkFDQVFBd0l6RUxNQWtHQTFVRUJoTUNWVk14RkRBU0JnTlZCQU1NQ3lvdVltRnVZVzVoTG1OaApNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXNKRFFiY0IxZVNwYjRjUmpEZXNWCm1lbmMvT0ZXMEZrcUQ3aUtDVVZmakFjSjdVOGowTTZmZC9FL3o1OFRrY0htQmRqbGlqcitoTStmVWRKMXhpQ3gKanlEMTkwZjU0N2s1RmZkYUFkcFhkaHpQZVJmVWt5MFlwTUY0M1BPVnc3MXhCQm8wQXgvK1RGNE9zd2tBa1J3egpFQVhpZkZTdlhPcUFnNG9BVG9MbVYrclh4cmFidFlBM1VFcGxxRTc2ZVdCdVdJbWpGZ2IzbDVWb25Sc1pPUXE1CjlVNE1aSzhoMi9LeEVqMUpGcFpSNnJteDdiUEZxOUNzbjhYb1V2MlRoRFBvNlNWRXJxUWxSdGNXVVFGSG9Ic2UKK0JUUmI5Q255WW5hdFF5YThaU0Y3QnZ4RFIrY0hyV04vNHhIeW1YdkU2VDJ4STFSN3pqQkZvQ3hISEVaY3MwTgowUUlEQVFBQm9BQXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBSmNlTTY2SnpwaFVwZm9NY1VNd3NhYU1YczVQCjFEQTFnYkMzOE9sZEkrU2NtMkJxeWlkVmNRVXBaclhBSTdhdUJ1ZzVQUlJmcEpVSWZKSExxYlUraTJJODRwQlAKOG4xR0RKeTg0dGllM2RaVlcvakhzVGQ4QVpNTGJVZkFPZUgxREVWRzdFK0dXWlRtd25UZnJKZnNNSy9mN3Y0YwpxemdsTGpBd29Cbjl5QWhvdVBpU1JZY0Vhdng2bzhVbFpLZFBuQ0tzb240WGV5RUh1cjUwLzlmS05sWlhRMENvCndmQ3E2MzJkQ2Q2L0VyRkpOQTVEemRzVnp3aDZiWXJIU3R0UlFMN012NThpaEEzeVBwN3dUYVg3UTBxK1hvZTEKYksvU1gvT3U3V1pGUXFzZy8raENHZHBxL3NUYy9RaGRBcjNaMTk1NmpiS2k5bjg2d2FzZTdwYjhGcGc9Ci0tLS0tRU5EIENFUlRJRklDQVRFIFJFUVVFU1QtLS0tLQo="
  ]
}
```

### Provider

[\[JSON Schema\]](schemasrovider.json)

The provider replies with certificates for each of the requested domain.

#### Example

```json
{
  "ca": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURNVENDQWhtZ0F3SUJBZ0lVUkF1S1hoc3RnNW5UTzBOMm90ZGtvbUVnWFFRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0tERUxNQWtHQTFVRUJoTUNWVk14R1RBWEJnTlZCQU1NRUhKdmIzUmpZUzVpWVc1aGJtRXVZMkV3SGhjTgpNakl3TnpJeU1qQTBNVFUzV2hjTk16SXdOekU1TWpBME1UVTNXakFvTVFzd0NRWURWUVFHRXdKVlV6RVpNQmNHCkExVUVBd3dRY205dmRHTmhMbUpoYm1GdVlTNWpZVENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0MKQVFvQ2dnRUJBTURKOHp1clhIejQyWkFsbW55OWpla01iUHdJVG5nRkY0N2Fta3VsWWpuMi9NditMU2FKbWp4bAptVjc1TVVvOGk2NG8zU3kvMURPdEJDVzlYRXF5Ti8zQkJ5QngrWHFjaDBYNHNBY09MdHN5VWRjcFFWRTI2N2x6CmZ4TlBmWUxGeHRoWFhsZDcwTk0vN2JhQVEyNkR0K3ZYMHVnRW9TRTg4ZVdnMVcrd3VhVVQwcXp0a2FMNGZEZ3cKS1ZUeVhEZlBEbE9DVzZUd3QxVExhcFMwWDlUaWF2OUdjRVRVcFhqV0NzMGRTMUhJTUNpQ3JXQTNmTFhHaEhkVApUMmtpWStnMlo0bTBIcGtNUGxPY08yK1pyemlYa0JaUWE5ck9tclNwOFdnOHVHTXBwMWFTQTJoa3RFbjIwUloyCm1vK05Xb1JMQjduYlpxRWNsdEdNNnFMSFFFc2t3V2NDQXdFQUFhTlRNRkV3SFFZRFZSME9CQllFRkVXNk1wOVcKYmxlOTV4L3dYbzBNUVNmR1Z2bG9NQjhHQTFVZEl3UVlNQmFBRkVXNk1wOVdibGU5NXgvd1hvME1RU2ZHVnZsbwpNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBR09mQlNMUDZsSlNEcXd4CjRjTEh1Y2YwZElXK0thY1ZlS0JJY0V5RGVxYzI3Vmp1dmY3VW9pZnk5M0JYWGYzdTRvc0lRaHlQMERiMDVmeloKRmtrODhCTzI0T1FRdVZyN1lZaEFiMGhvam9OdS9CRzNEbmlHTUROenZMQUZOemxvdFpzSlphRTJFQnZNcjRRRQpZWVdsNFRKZ0NyQnJqVjc1SWowMzBweFdENHpyTDRmYUo4dmdjT1p3SnQ4UHlBenZyaXd2S1drQU4rdmFxUmRtCld6OXJlYWl5NGIrbkRwNmJVeW5sOWh5NDdpSVp2N0dZWENyRjc3R3ZJOW9IYSsxTnBnOE9aOEJob1dHM01weFEKcis4Q1ZkUnFnanlURnlDc3VpK2Y1MWJpaXBBdm1XbGc0bmFBdU80d2FYeGM2TWFTU2JJNzk4UGprMlptaitNdApIM0x0RzNRPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==",
  "certificates": [
    "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURmekNDQW1lZ0F3SUJBZ0lVV1RFUGNPM3lDczFRZDNTSkVtQ3BsZi9WU2prd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0tERUxNQWtHQTFVRUJoTUNWVk14R1RBWEJnTlZCQU1NRUhKdmIzUmpZUzVpWVc1aGJtRXVZMkV3SGhjTgpNakl3TnpJeU1qQTBNVFUzV2hjTk1qUXhNREkwTWpBME1UVTNXakFqTVFzd0NRWURWUVFHRXdKVlV6RVVNQklHCkExVUVBd3dMS2k1aVlXNWhibUV1WTJFd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUIKQVFDd2tOQnR3SFY1S2x2aHhHTU42eFdaNmR6ODRWYlFXU29QdUlvSlJWK01Cd250VHlQUXpwOTM4VC9QbnhPUgp3ZVlGMk9XS092NkV6NTlSMG5YR0lMR1BJUFgzUi9uanVUa1Y5MW9CMmxkMkhNOTVGOVNUTFJpa3dYamM4NVhECnZYRUVHalFESC81TVhnNnpDUUNSSERNUUJlSjhWSzljNm9DRGlnQk9ndVpYNnRmR3RwdTFnRGRRU21Xb1R2cDUKWUc1WWlhTVdCdmVYbFdpZEd4azVDcm4xVGd4a3J5SGI4ckVTUFVrV2xsSHF1Ykh0czhXcjBLeWZ4ZWhTL1pPRQpNK2pwSlVTdXBDVkcxeFpSQVVlZ2V4NzRGTkZ2MEtmSmlkcTFESnJ4bElYc0cvRU5INXdldFkzL2pFZktaZThUCnBQYkVqVkh2T01FV2dMRWNjUmx5elEzUkFnTUJBQUdqZ2FVd2dhSXdDUVlEVlIwVEJBSXdBREJWQmdOVkhSRUUKVGpCTWdnc3FMbUpoYm1GdVlTNWpZWUlQS2k1dWJYTXVZbUZ1WVc1aExtTmhnaE1xTG5OMFlXZHBibWN1WW1GdQpZVzVoTG1OaGdoY3FMbTV0Y3k1emRHRm5hVzVuTG1KaGJtRnVZUzVqWVRBZEJnTlZIUTRFRmdRVWxCSUVpbzJRCk1qSGF5bG4wQm5ibmZrRHkya1F3SHdZRFZSMGpCQmd3Rm9BVVJib3luMVp1VjczbkgvQmVqUXhCSjhaVytXZ3cKRFFZSktvWklodmNOQVFFTEJRQURnZ0VCQUZwTDRGbXpIb2JCcXBBakdrbE9GOVpuVTBHd0x1ak5yazdEcDdkWApBNWIrcVM0cHY4Zk55aWMrbWp1OXpDcXl4bFlUcnFWUk5zbzh0UytNM25ibVVCbHFhV0NaT0h5a1RjS1ZaK2VpCjF2eWYwWlRPbmFqVTlSYnVZVHA0Z0JPbDBnbW94UktBbzZaVkg4eUU2YklyVzR2c2tuNnBiZGNGd1kxVGR3VWoKa0d1RWFsdjU0VlQvQUgrWEhEM3VDcFRrY0swNEI2TWhhLzlRMndpTTg2OGFOQUx0SFlia0FpOFJaQnVkYnF0dwova3ZMUHhQejZJMTk3SDZhZEdLNjdrU1pKd2JnYTFQc0ZEeUFoYzFBcHI1RU1ZaUpST0xFc0l5VmsxU3p0N09oClJDMEdYSTFENGRQcnNkaFBTUXJSbFZBc3VGQ3hHNmJTYTNRdkNGUmdEclY3WVlZPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="
  ]
}
```

## Example Implementations

### providers
  - vault-k8s
  - tls-certificates-operator

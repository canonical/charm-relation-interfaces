name: Matrix tests for a specific interface

on:
  workflow_dispatch:
    inputs:
      interface:
        description: 'The interface to run tests for'
        required: true
        type: string
      repo:
        description: 'The repo to fetch the test and interfaces definitions from'
        default: ''
        required: false
        type: string
      branch:
        description: 'The branch of the repo to fetch the test and interface definitions from'
        default: ''
        required: false
        type: string
  workflow_call:
    inputs:
      event:
        description: 'The triggering event of this workflow call'
        required: true
        type: string
      interface:
        description: 'The interface to run tests for'
        required: true
        type: string
      repo:
        description: 'The repo to fetch the test and interfaces definitions from'
        default: ''
        required: false
        type: string
      branch:
        description: 'The branch of the repo to fetch the test and interface definitions from'
        default: ''
        required: false
        type: string

jobs:
  matrix-tests:
    name: 'Matrix tests for ${{ inputs.interface }}'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
      - name: Set up python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      - name: Install dependencies
        run: pip install tox uv poetry
      - name: Run tests
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN_WITH_TEAM }}
          MATRIX_EVENT: ${{ inputs.event || 'no-event-input' }}
        run: |
          echo MATRIX_EVENT $MATRIX_EVENT
          tox -e run-interface-test-matrix -- --include ${{ inputs.interface }} --repo ${{ inputs.repo || github.repository }} --branch ${{ inputs.branch || github.ref_name }}

{
    "$schema": "https://json-schema.org/draft/2019-09/schema",
    "$id": "https://canonical.github.io/charm-relation-interfaces/interfaces/database_backup_manager/schemas/requirer.json",
    "title": "`database_backup_manager` requirer schema",
    "description": "The `database_backup_manager` root schema comprises the entire requirer databag for this interface.",
    "type": "object",
    "default": {},
    "additionalProperties": true,
    "oneOf": [
        {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "job-id",
                "job-type",
                "storage-interface"
            ],
            "properties": {
                "job-id": {
                    "$ref": "#/$defs/job-id"
                },
                "job-type": {
                    "$ref": "#/$defs/job-type"
                },
                "storage-interface": {
                    "$ref": "#/$defs/storage-interface"
                },
                "s3-config": {
                    "type": "object",
                    "properties": {
                        "access-key": {
                            "$ref": "#/$defs/access-key"
                        },
                        "secret-key": {
                            "$ref": "#/$defs/secret-key"
                        },
                        "log-file": {
                            "$ref": "#/$defs/log-file"
                        },
                        "backup-file": {
                            "$ref": "#/$defs/backup-file"
                        }
                    },
                    "required": [
                        "access-key",
                        "secret-key",
                        "log-file",
                        "backup-file"
                    ],
                    "additionalProperties": false
                }
            }
        },
        {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "job-id",
                "job-type",
                "storage-interface"
            ],
            "properties": {
                "job-id": {
                    "$ref": "#/$defs/job-id"
                },
                "job-type": {
                    "$ref": "#/$defs/job-type"
                },
                "storage-interface": {
                    "$ref": "#/$defs/storage-interface"
                },
                "s3-config": {
                    "type": "object",
                    "properties": {
                        "access-key": {
                            "$ref": "#/$defs/access-key"
                        },
                        "secret-key": {
                            "$ref": "#/$defs/secret-key"
                        },
                        "log-file": {
                            "$ref": "#/$defs/log-file"
                        },
                        "restore-file": {
                            "$ref": "#/$defs/restore-file"
                        }
                    },
                    "required": [
                        "access-key",
                        "secret-key",
                        "log-file",
                        "restore-file"
                    ],
                    "additionalProperties": false
                }
            }
        }
    ],
    "$defs": {
        "job-id": {
            "title": "Job ID",
            "description": "A unique id for the job. Is the same value as the one provided by the Requirer.",
            "type": "string",
            "examples": [
                "job-01693ed2-644f-11ed-81ce-0242ac120002"
            ]
        },
        "job-type": {
            "title": "Job type",
            "description": "The job type. Is the same value as the one provided by the Requirer.",
            "type": "string",
            "enum": ["backup", "restore"],
            "default": "backup"
        },
        "storage-interface": {
            "title": "Storage interface",
            "description": "The storage interface to use for storing or retrieving files",
            "type": "string",
            "enum": ["s3"],
            "default": "s3"
        },
        "access-key": {
            "title": "S3 Access Key",
            "description": "The S3 access key with which to access the S3 bucket with",
            "type": "string",
            "examples": [
                "access-key"
            ]
        },
        "secret-key": {
            "title": "S3 Secret Key",
            "description": "The S3 secret key with which to access the S3 bucket with",
            "type": "string",
            "examples": [
                "secret-key"
            ]
        },
        "log-file": {
            "title": "Log file path",
            "description": "Path where the job is expected to upload a log file to",
            "type": "string",
            "examples": [
                "s3://bucket/mysql/2022-01-01T01:01:01.123456/logs/backup.log"
            ]
        },
        "backup-file": {
            "title": "Backup file path",
            "description": "Path where the job is expected to upload the backup file",
            "type": "string",
            "examples": [
                "s3://bucket/mysql/2022-01-01T01:01:01.123456/backups/mysql.backup"
            ]
        },
        "restore-file": {
            "title": "Restore file path",
            "description": "Path where the job is expected to retrieve the restore file",
            "type": "string",
            "examples": [
                "s3://bucket/mysql/2022-01-01T01:01:01.123456/backups/mysql.backup"
            ]
        }
    },
    "examples": [
        {
            "job-id": "job-01693ed2-644f-11ed-81ce-0242ac120002",
            "job-type": "backup",
            "storage-interface": "s3",
            "s3-config": {
                "access-key": "access-key",
                "secret-key": "secret-key",
                "log-file": "s3://bucket/mysql/2022-01-01T01:01:01.123456/logs/backup.log",
                "backup-file": "s3://bucket/mysql/2022-01-01T01:01:01.123456/backups/mysql.backup"
            }
        },
        {
            "job-id": "job-ad989f5a-6453-11ed-81ce-0242ac120002",
            "job-type": "restore",
            "storage-interface": "s3",
            "s3-config": {
                "access-key": "access-key",
                "secret-key": "secret-key",
                "log-file": "s3://bucket/mysql/2023-01-01T01:01:01.123456/logs/backup.log",
                "restore-file": "s3://bucket/mysql/2022-01-01T01:01:01.123456/backups/mysql.backup"
            }
        }
    ]
}

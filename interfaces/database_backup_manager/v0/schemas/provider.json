{
    "$schema": "https://json-schema.org/draft/2019-09/schema",
    "$id": "https://canonical.github.io/charm-relation-interfaces/interfaces/database_backup_manager/schemas/provider.json",
    "title": "`database_backup_manager` provider schema",
    "description": "The `database_backup_manager` root schema comprises the entire provider databag for this interface.",
    "type": "object",
    "default": {},
    "additionalProperties": true,
    "oneOf": [
        {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "job-id",
                "job-type",
                "status",
                "storage-interface",
                "s3-config",
                "log-file",
                "backup-file"
            ],
            "properties": {
                "job-id": {
                    "$ref": "#/$defs/job-id"
                },
                "job-type": {
                    "$ref": "#/$defs/job-type"
                },
                "status": {
                    "$ref": "#/$defs/status"
                },
                "storage-interface": {
                    "$ref": "#/$defs/storage-interface"
                },
                "s3-config": {
                    "$ref": "https://canonical.github.io/charm-relation-interfaces/interfaces/s3/schemas/provider.json"
                },
                "log-file": {
                    "$ref": "#/$defs/log-file"
                },
                "backup-file": {
                    "$ref": "#/$defs/backup-file"
                }
            }
        },
        {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "job-id",
                "job-type",
                "status",
                "storage-interface",
                "s3-config",
                "restore-file"
            ],
            "properties": {
                "job-id": {
                    "$ref": "#/$defs/job-id"
                },
                "job-type": {
                    "$ref": "#/$defs/job-type"
                },
                "status": {
                    "$ref": "#/$defs/status"
                },
                "storage-interface": {
                    "$ref": "#/$defs/storage-interface"
                },
                "s3-config": {
                    "$ref": "https://canonical.github.io/charm-relation-interfaces/interfaces/s3/schemas/provider.json"
                },
                "restore-file": {
                    "$ref": "#/$defs/restore-file"
                }
            }
        }
    ],
    "$defs": {
        "job-id": {
            "title": "Job ID",
            "description": "A unique id for the job. Is the same value as the one provided by the Requirer.",
            "type": "string",
            "examples": [
                "job-01693ed2-644f-11ed-81ce-0242ac120002"
            ]
        },
        "job-type": {
            "title": "Job type",
            "description": "The job type. Is the same value as the one provided by the Requirer.",
            "type": "string",
            "enum": ["backup", "restore"],
            "default": "backup"
        },
        "status": {
            "title": "Job status",
            "description": "The status of the job once it has completed",
            "type": "string",
            "enum": ["running", "success", "error"]
        },
        "storage-interface": {
            "title": "Storage interface",
            "description": "The storage interface to use for storing or retrieving files",
            "type": "string",
            "enum": ["s3"],
            "default": "s3"
        },
        "log-file": {
            "title": "Log file path",
            "description": "Path where the job is expected to upload a log file to",
            "type": "string",
            "examples": [
                "s3://bucket/mysql/2022-01-01T01:01:01.123456/logs/backup.log"
            ]
        },
        "backup-file": {
            "title": "Backup file path",
            "description": "Path where the job is expected to upload the backup file",
            "type": "string",
            "examples": [
                "s3://bucket/mysql/2022-01-01T01:01:01.123456/backups/mysql.backup"
            ]
        },
        "restore-file": {
            "title": "Restore file path",
            "description": "Path where the job is expected to retrieve the restore file",
            "type": "string",
            "examples": [
                "s3://bucket/mysql/2022-01-01T01:01:01.123456/backups/mysql.backup"
            ]
        }
    },
    "examples": [
        {
            "job-id": "job-01693ed2-644f-11ed-81ce-0242ac120002",
            "job-type": "backup",
            "status": "success",
            "storage-interface": "s3",
            "s3-config": {
                "bucket": "my-bucket",
                "access-key": "access-key",
                "secret-key": "secret-key"
            },
            "log-file": "s3://bucket/mysql/2022-01-01T01:01:01.123456/logs/backup.log",
            "backup-file": "s3://bucket/mysql/2022-01-01T01:01:01.123456/backups/mysql.backup"
        },
        {
            "job-id": "job-d0e6d45c-6450-11ed-81ce-0242ac120002",
            "job-type": "restore",
            "status": "error",
            "storage-interface": "s3",
            "s3-config": {
                "bucket": "my-bucket",
                "access-key": "access-key",
                "secret-key": "secret-key"
            },
            "restore-file": "s3://bucket/mysql/2022-01-01T01:01:01.123456/backups/mysql.backup"
        }
    ]
}
